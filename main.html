<!-- Nofee AI â€“ ì•ˆì •í™” ë²„ì „ -->
<div id='nofee-ai-wrapper'>
  <!-- CSS ë¡œë“œ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Jacob-PO/nofee_chat@main/main.css">
  
  <!-- í´ë°± ìŠ¤íƒ€ì¼ -->
  <style>
    #nofee-ai-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    .nofee-chat-container {
      width: 100%;
      height: 100%;
      background: #f9faff;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .nofee-header {
      background: #fff;
      border-bottom: 1px solid #e5e7eb;
      padding: 16px 20px;
      flex-shrink: 0;
    }
    .nofee-chat-wrapper {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }
    .nofee-loading {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }
  </style>

  <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
  <div class='nofee-chat-container'>
    <!-- í—¤ë” -->
    <div class='nofee-header'>
      <div class='nofee-header-content'>
        <div class='nofee-header-left'>
          <div class='nofee-profile-img'>
            <svg width='28' height='28' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2'>
              <path d='M12 2L2 7L12 12L22 7L12 2Z'/>
              <path d='M2 17L12 22L22 17'/>
              <path d='M2 12L12 17L22 12'/>
            </svg>
          </div>
          <div class='nofee-header-text'>
            <h3>ë…¸í”¼ AI</h3>
            <p>ìµœì €ê°€ íœ´ëŒ€í° ì¶”ì²œ ì„œë¹„ìŠ¤</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ì±„íŒ… ì˜ì—­ -->
    <div class='nofee-chat-wrapper' id='nofeeChat'>
      <!-- ë¡œë”© -->
      <div class='nofee-loading' id='nofeeLoading'>
        <div class='nofee-loading-spinner'></div>
        <p>AIë¥¼ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        <small>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</small>
      </div>
      
      <!-- ì¸íŠ¸ë¡œ -->
      <div class='nofee-intro-section' id='nofeeIntro' style='display:none'>
        <div class='nofee-intro-content'>
          <div class='nofee-intro-avatar'>
            <svg width='60' height='60' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='1.5'>
              <path d='M12 2L2 7L12 12L22 7L12 2Z'/>
              <path d='M2 17L12 22L22 17'/>
              <path d='M2 12L12 17L22 12'/>
            </svg>
          </div>
          <h2>ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹</h2>
          <p>ìµœì ì˜ íœ´ëŒ€í°ì„ ì°¾ì•„ë“œë¦¬ëŠ”<br>ë…¸í”¼ AIì…ë‹ˆë‹¤</p>
          <button class='nofee-start-btn' id='startConsultBtn'>
            AI ìƒë‹´ ì‹œì‘í•˜ê¸°
          </button>
        </div>
      </div>
      
      <!-- ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ -->
      <div class='nofee-messages-container' id='nofeeMessages' style='display:none'></div>
    </div>

    <!-- AI ìƒê°ì¤‘ -->
    <div class='nofee-ai-thinking' id='aiThinking' style='display:none'>
      <div class='nofee-thinking-content'>
        <div class='nofee-ai-dots'>
          <div class='nofee-ai-dot'></div>
          <div class='nofee-ai-dot'></div>
          <div class='nofee-ai-dot'></div>
        </div>
        <span class='nofee-ai-thinking-text'>AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</span>
      </div>
    </div>
  </div>

  <!-- ì›¹í”Œë¡œìš° í¼ (ìˆ¨ê¹€) -->
  <form id='nofee-purchase-form' name='purchase' data-name='Purchase Form' style='position:absolute;left:-9999px;visibility:hidden;'>
    <input type='hidden' name='customer_name' id='customer_name'>
    <input type='hidden' name='customer_phone' id='customer_phone'>
    <input type='hidden' name='customer_region' id='customer_region'>
    <input type='hidden' name='customer_district' id='customer_district'>
    <input type='hidden' name='privacy_consent' id='privacy_consent' value=''>
    <input type='hidden' name='phone_model' id='phone_model'>
    <input type='hidden' name='phone_carrier' id='phone_carrier'>
    <input type='hidden' name='phone_plan' id='phone_plan'>
    <input type='hidden' name='phone_price' id='phone_price'>
    <input type='hidden' name='monthly_payment' id='monthly_payment'>
    <input type='hidden' name='contract_type' id='contract_type'>
    <input type='hidden' name='activation_type' id='activation_type'>
    <input type='hidden' name='timestamp' id='timestamp'>
    <input type='hidden' name='session_id' id='session_id'>
  </form>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // DOM ì¤€ë¹„ í™•ì¸
    function waitForDOM(callback) {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', callback);
      } else {
        callback();
      }
    }
    
    // ì´ˆê¸°í™”
    waitForDOM(function() {
      // í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì•ˆì „í•˜ê²Œ)
      const form = document.getElementById('nofee-purchase-form');
      if (form) {
        form.addEventListener('submit', function(e) {
          const consent = document.getElementById('privacy_consent');
          if (!consent || consent.value !== 'ë™ì˜í•¨') {
            e.preventDefault();
            console.log('ê°œì¸ì •ë³´ ë™ì˜ í•„ìš”');
            return false;
          }
        });
      }
      
      // ì‹œì‘ ë²„íŠ¼ ì´ë²¤íŠ¸
      const startBtn = document.getElementById('startConsultBtn');
      if (startBtn) {
        startBtn.onclick = function() {
          if (window.NofeeAI && window.NofeeAI.startConsultation) {
            window.NofeeAI.startConsultation();
          }
        };
      }
      
      // ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
      loadNofeeScript();
    });
    
    // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
    function loadNofeeScript() {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/gh/Jacob-PO/nofee_chat@main/main.js?v=' + Date.now();
      script.onload = function() {
        console.log('ë…¸í”¼ AI ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
        if (window.NofeeAI && window.NofeeAI.init) {
          window.NofeeAI.init();
        }
      };
      script.onerror = function() {
        console.error('ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨');
        const loading = document.getElementById('nofeeLoading');
        if (loading) {
          loading.innerHTML = 
            '<p style="color:#ef4444">ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>' +
            '<button onclick="location.reload()" style="margin-top:16px;padding:10px 24px;background:#4e5bff;color:white;border:none;border-radius:24px;cursor:pointer;font-weight:600">ë‹¤ì‹œ ì‹œë„</button>';
        }
      };
      document.head.appendChild(script);
    }
  </script>
</div>
