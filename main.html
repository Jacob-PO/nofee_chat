<!-- 노피 AI 챗봇 - Webflow Embed HTML -->
<div id="nofee-ai-wrapper">
    <!-- 인라인 스타일 (즉시 적용) -->
    <style>
        /* 기본 스타일 (CDN 로드 실패 시 최소한의 스타일 보장) */
        #nofee-ai-wrapper {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }
        .nofee-app {
            width: 100%;
            height: 800px;
            background: #ffffff;
            color: #333333;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow: hidden;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .nofee-loading-screen {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ffffff;
        }
    </style>
    
    <!-- 메인 앱 컨테이너 -->
    <div class="nofee-app" id="nofeeApp">
        <!-- 로딩 화면 -->
        <div class="nofee-loading-screen" id="nofeeLoading">
            <div class="nofee-loading-content">
                <div class="nofee-logo-animation">
                    <div class="nofee-logo-circle"></div>
                    <div class="nofee-logo-pulse"></div>
                </div>
                <h1 class="nofee-loading-title">노피 AI</h1>
                <p class="nofee-loading-subtitle">당신을 위한 AI가 준비중입니다</p>
                <div class="nofee-loading-progress">
                    <div class="nofee-loading-bar"></div>
                </div>
            </div>
        </div>

        <!-- 메인 인터페이스 -->
        <div class="nofee-interface" id="nofeeInterface" style="display: none;">
            <!-- 배경 효과 -->
            <div class="nofee-bg-effects">
                <div class="nofee-gradient-orb nofee-orb-1"></div>
                <div class="nofee-gradient-orb nofee-orb-2"></div>
                <div class="nofee-gradient-orb nofee-orb-3"></div>
            </div>

            <!-- 헤더 -->
            <header class="nofee-header">
                <div class="nofee-header-content">
                    <div class="nofee-brand">
                        <div class="nofee-brand-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <span class="nofee-brand-name">노피 AI</span>
                    </div>
                    <div class="nofee-header-actions">
                        <button class="nofee-icon-btn" id="nofeeMenuBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="5" r="1" fill="currentColor"/>
                                <circle cx="12" cy="12" r="1" fill="currentColor"/>
                                <circle cx="12" cy="19" r="1" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </header>

            <!-- 채팅 영역 -->
            <main class="nofee-main">
                <div class="nofee-chat-container" id="nofeeChat">
                    <!-- 웰컴 화면 -->
                    <div class="nofee-welcome" id="nofeeWelcome">
                        <div class="nofee-welcome-content">
                            <div class="nofee-ai-avatar">
                                <div class="nofee-avatar-glow"></div>
                                <div class="nofee-avatar-core">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none">
                                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                            </div>
                            <h1 class="nofee-welcome-title">안녕하세요, 노피 AI입니다</h1>
                            <p class="nofee-welcome-desc">최적의 휴대폰을 찾아드리는 AI 어시스턴트</p>
                            <div class="nofee-feature-cards">
                                <div class="nofee-feature-card">
                                    <div class="nofee-feature-icon">✨</div>
                                    <span>AI 맞춤 추천</span>
                                </div>
                                <div class="nofee-feature-card">
                                    <div class="nofee-feature-icon">💰</div>
                                    <span>수수료 NO</span>
                                </div>
                                <div class="nofee-feature-card">
                                    <div class="nofee-feature-icon">🚀</div>
                                    <span>빠른 상담</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 메시지 영역 -->
                    <div class="nofee-messages" id="nofeeMessages"></div>

                    <!-- AI 타이핑 인디케이터 -->
                    <div class="nofee-typing-indicator" id="nofeeTyping" style="display: none;">
                        <div class="nofee-typing-avatar">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="nofee-typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            </main>

            <!-- 하단 액션 바 -->
            <footer class="nofee-footer" id="nofeeFooter">
                <div class="nofee-quick-actions">
                    <button class="nofee-quick-btn" id="nofeeHomeBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M3 9L12 2L21 9V20C21 21.1 20.1 22 19 22H5C3.9 22 3 21.1 3 20V9Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>처음으로</span>
                    </button>
                    <button class="nofee-quick-btn" id="nofeePhoneBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <rect x="5" y="2" width="14" height="20" rx="2" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="18" r="1" fill="currentColor"/>
                        </svg>
                        <span>상품보기</span>
                    </button>
                    <button class="nofee-quick-btn nofee-quick-primary" id="nofeeStartBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>AI 상담 시작</span>
                    </button>
                </div>
            </footer>
        </div>

        <!-- 메뉴 오버레이 -->
        <div class="nofee-menu-overlay" id="nofeeMenu" style="display: none;">
            <div class="nofee-menu-content">
                <div class="nofee-menu-header">
                    <h2>메뉴</h2>
                    <button class="nofee-icon-btn" id="nofeeCloseMenu">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </button>
                </div>
                <nav class="nofee-menu-nav">
                    <a href="#" class="nofee-menu-item">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M22 12H18L15 21L9 3L6 12H2" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>운영시간</span>
                    </a>
                    <a href="#" class="nofee-menu-item">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>배송정보</span>
                    </a>
                    <a href="https://nofee.team/policy" target="_blank" class="nofee-menu-item">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 22C17.5 22 22 17.5 22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 8V16" stroke="currentColor" stroke-width="2"/>
                            <path d="M8 12H16" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>개인정보처리방침</span>
                    </a>
                </nav>
            </div>
        </div>
    </div>

    <!-- Webflow 숨김 폼 -->
    <form id="nofee-purchase-form" name="purchase" data-name="Purchase Form" style="display: none;">
        <!-- 고객 정보 -->
        <input type="hidden" name="customer_name" id="customer_name">
        <input type="hidden" name="customer_phone" id="customer_phone">
        <input type="hidden" name="customer_region" id="customer_region">
        <input type="hidden" name="customer_district" id="customer_district">
        <input type="hidden" name="privacy_consent" id="privacy_consent">
        
        <!-- 상품 정보 -->
        <input type="hidden" name="phone_model" id="phone_model">
        <input type="hidden" name="phone_carrier" id="phone_carrier">
        <input type="hidden" name="phone_plan" id="phone_plan">
        <input type="hidden" name="phone_price" id="phone_price">
        <input type="hidden" name="monthly_payment" id="monthly_payment">
        <input type="hidden" name="contract_type" id="contract_type">
        <input type="hidden" name="activation_type" id="activation_type">
        
        <!-- 추가 정보 -->
        <input type="hidden" name="timestamp" id="timestamp">
        <input type="hidden" name="session_id" id="session_id">
        <input type="hidden" name="utm_source" id="utm_source">
        <input type="hidden" name="utm_medium" id="utm_medium">
        <input type="hidden" name="utm_campaign" id="utm_campaign">
        
        <input type="submit" value="Submit">
    </form>

    <!-- JavaScript 로드 및 초기화 -->
    <script>
        // 메뉴 토글
        document.getElementById('nofeeMenuBtn').onclick = function() {
            document.getElementById('nofeeMenu').style.display = 'flex';
        };
        document.getElementById('nofeeCloseMenu').onclick = function() {
            document.getElementById('nofeeMenu').style.display = 'none';
        };

        /* ========= 경로 설정 ========= */
        const SCRIPT_CANDIDATES = [
            'https://cdn.jsdelivr.net/gh/Jacob-PO/nofee_chat@main/main.js',
            'https://jacob-po.github.io/nofee_chat/main.js'
        ];

        /* ========= 유틸 ========= */
        function appendScript(src) {
            return new Promise((resolve, reject) => {
                const s = document.createElement('script');
                s.src = `${src}?v=${Date.now()}`;
                s.async = true;
                s.onload = () => {
                    if (window.NofeeAI?.init) {
                        resolve(src);
                    } else {
                        reject(new Error(`${src} loaded but NofeeAI missing`));
                    }
                };
                s.onerror = () => reject(new Error(`${src} 로드 실패`));
                document.head.appendChild(s);
            });
        }

        /* ========= 메인 로더 ========= */
        function loadNofeeScript() {
            Promise.any(SCRIPT_CANDIDATES.map(appendScript))
                .then((okSrc) => {
                    console.log(`✅ main.js 로드 성공 →`, okSrc);
                    // 로딩 완료 후 초기화
                    setTimeout(() => {
                        document.getElementById('nofeeLoading').style.display = 'none';
                        document.getElementById('nofeeInterface').style.display = 'flex';
                        window.NofeeAI.init();
                    }, 1500);
                })
                .catch((err) => {
                    console.error('🚨 main.js를 불러올 수 없습니다:', err);
                    document.querySelector('.nofee-loading-subtitle').textContent = '초기화에 실패했습니다. 새로고침해주세요.';
                });
        }
        
        // 즉시 실행
        loadNofeeScript();
    </script>
</div>
